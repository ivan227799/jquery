 import fs from "node:fs/promises";
import path from "node:path";

const sourceFilePath = path.resolve("./test/data/qunit-fixture.html");
const outputFilePath = path.resolve("./test/data/qunit-fixture.js");

async function generateFixture() {
    try {
        console.log(`ðŸ”„ Reading source file: ${sourceFilePath}`);
        const fixtureContent = await fs.readFile(sourceFilePath, "utf8");

        console.log("âœ… Successfully read source file.");
        const normalizedContent = fixtureContent.replace(/\r\n/g, "\n");
        const outputContent =
            "// Generated by build/tasks/qunit-fixture.js\n" +
            "QUnit.config.fixture = " +
            JSON.stringify(normalizedContent) +
            ";\n";

        console.log(`ðŸ”„ Writing to output file: ${outputFilePath}`);
        await fs.writeFile(outputFilePath, outputContent, "utf8");

        console.log(`ðŸŽ‰ Successfully updated fixture: ${outputFilePath}`);
    } catch (error) {
        console.error("ðŸš¨ Error occurred while generating the fixture:", error);
        process.exit(1); // Exit with a non-zero code to signal failure in CI/CD pipelines
    }
}

generateFixture();
